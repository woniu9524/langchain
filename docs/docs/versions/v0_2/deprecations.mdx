---
sidebar_position: 3
sidebar_label: Changes
keywords: [retrievalqa, llmchain, conversationalretrievalchain]
---

# 弃用和重大更改

此代码包含 `langchain` 和 `langchain-core` 包中弃用和移除的列表。

此处未列出新功能和改进。请参阅[概述](/docs/versions/v0_2/overview/)以了解此版本的新增功能的摘要。

## 重大更改

自 0.2.0 版本起，`langchain` 被要求是与集成无关的。这意味着 `langchain` 中的代码默认不应实例化任何特定的聊天模型、LLM、嵌入模型、向量存储等；相反，用户需要显式指定这些。

以下函数和类需要作为参数显式传递 LLM：

- `langchain.agents.agent_toolkits.vectorstore.toolkit.VectorStoreToolkit`
- `langchain.agents.agent_toolkits.vectorstore.toolkit.VectorStoreRouterToolkit`
- `langchain.chains.openai_functions.get_openapi_chain`
- `langchain.chains.router.MultiRetrievalQAChain.from_retrievers`
- `langchain.indexes.VectorStoreIndexWrapper.query`
- `langchain.indexes.VectorStoreIndexWrapper.query_with_sources`
- `langchain.indexes.VectorStoreIndexWrapper.aquery_with_sources`
- `langchain.chains.flare.FlareChain`

以下类现在需要传递显式的嵌入模型作为参数：

- `langchain.indexes.VectostoreIndexCreator`

以下代码已被移除：

- `langchain.natbot.NatBotChain.from_default` 已被 `from_llm` 类方法取代。

以下代码的行为已更改：

### @tool 装饰器

`@tool` 装饰器现在将函数的 docstring 分配为工具描述。以前，`@tool` 装饰器用于在函数签名之前添加前缀。

在 0.2.0 之前：

```python
@tool
def my_tool(x: str) -> str:
    """Some description."""
    return "something"

print(my_tool.description)
```

结果是：`my_tool: (x: str) -> str - Some description.`

作为 0.2.0 起：

结果将是：`Some description.`

## 代码已移动到其他包

已从 `langchain` 移动到其他包（例如 `langchain-community`）的代码

如果您尝试从 `langchain` 导入，导入将继续工作，但会引发弃用警告。该警告将提供一个替换的导入语句。

```shell
 python -c "from langchain.document_loaders.markdown import UnstructuredMarkdownLoader"
```

```shell
LangChainDeprecationWarning: Importing UnstructuredMarkdownLoader from langchain.document_loaders is deprecated. Please replace deprecated imports:

 >> from langchain.document_loaders import UnstructuredMarkdownLoader

 with new imports of:

 >> from langchain_community.document_loaders import UnstructuredMarkdownLoader
```

只要安装了相关包（例如，只要 `langchain_community` 已安装），我们将继续支持 `langchain` 中的导入直到 0.4 版本。

但是，我们建议用户不要依赖这些导入，而是迁移到新的导入。为了帮助完成此过程，我们通过 LangChain CLI 发布了一个迁移脚本。请参阅迁移指南中的进一步说明。

## 目标移除的代码

已有更好的替代方案并且最终将被移除的代码，这样只有一种方法可以做事情。（例如，ChatModels 中的 `predict_messages` 方法已弃用，推荐使用 `invoke`）。

### astream 事件 V1

如果您正在使用 `astream_events`，请查看如何[迁移到 astream 事件 v2](/docs/versions/v0_2/migrating_astream_events)。

### langchain_core

#### try_load_from_hub

模块：`utils.loading`
已弃用：0.1.30
移除：0.3.0

替代方案：使用 `hwchase17/langchain-hub` 存储库进行提示已弃用。请使用 https://smith.langchain.com/hub。

#### BaseLanguageModel.predict

模块：`language_models.base`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseLanguageModel.predict_messages

模块：`language_models.base`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseLanguageModel.apredict

模块：`language_models.base`
已弃用：0.1.7
移除：0.3.0

替代方案：`ainvoke`

#### BaseLanguageModel.apredict_messages

模块：`language_models.base`
已弃用：0.1.7
移除：0.3.0

替代方案：`ainvoke`

#### RunTypeEnum

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：使用字符串。

#### TracerSessionV1Base

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### TracerSessionV1Create

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### TracerSessionV1

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### TracerSessionBase

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### TracerSession

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### BaseRun

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：`Run`

#### LLMRun

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：`Run`

#### ChainRun

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：`Run`

#### ToolRun

模块：`tracers.schemas`
已弃用：0.1.0
移除：0.3.0

替代方案：`Run`

#### BaseChatModel.__call__

模块：`language_models.chat_models`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseChatModel.call_as_llm

模块：`language_models.chat_models`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseChatModel.predict

模块：`language_models.chat_models`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseChatModel.predict_messages

模块：`language_models.chat_models`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseChatModel.apredict

模块：`language_models.chat_models`
已弃用：0.1.7
移除：0.3.0

替代方案：`ainvoke`

#### BaseChatModel.apredict_messages

模块：`language_models.chat_models`
已弃用：0.1.7
移除：0.3.0

替代方案：`ainvoke`

#### BaseLLM.__call__

模块：`language_models.llms`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseLLM.predict

模块：`language_models.llms`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseLLM.predict_messages

模块：`language_models.llms`
已弃用：0.1.7
移除：0.3.0

替代方案：`invoke`

#### BaseLLM.apredict

模块：`language_models.llms`
已弃用：0.1.7
移除：0.3.0

替代方案：`ainvoke`

#### BaseLLM.apredict_messages

模块：`language_models.llms`
已弃用：0.1.7
移除：0.3.0

替代方案：`ainvoke`

#### BaseRetriever.get_relevant_documents

模块：`retrievers`
已弃用：0.1.46
移除：0.3.0

替代方案：`invoke`

#### BaseRetriever.aget_relevant_documents

模块：`retrievers`
已弃用：0.1.46
移除：0.3.0

替代方案：`ainvoke`

#### ChatPromptTemplate.from_role_strings

模块：`prompts.chat`
已弃用：0.0.1
移除：

替代方案：`from_messages` 类方法

#### ChatPromptTemplate.from_strings

模块：`prompts.chat`
已弃用：0.0.1
移除：

替代方案：`from_messages` 类方法

#### BaseTool.__call__

模块：`tools`
已弃用：0.1.47
移除：0.3.0

替代方案：`invoke`

#### convert_pydantic_to_openai_function

模块：`utils.function_calling`
已弃用：0.1.16
移除：0.3.0

替代方案：`langchain_core.utils.function_calling.convert_to_openai_function()`

#### convert_pydantic_to_openai_tool

模块：`utils.function_calling`
已弃用：0.1.16
移除：0.3.0

替代方案：`langchain_core.utils.function_calling.convert_to_openai_tool()`

#### convert_python_function_to_openai_function

模块：`utils.function_calling`
已弃用：0.1.16
移除：0.3.0

替代方案：`langchain_core.utils.function_calling.convert_to_openai_function()`

#### format_tool_to_openai_function

模块：`utils.function_calling`
已弃用：0.1.16
移除：0.3.0

替代方案：`langchain_core.utils.function_calling.convert_to_openai_function()`

#### format_tool_to_openai_tool

模块：`utils.function_calling`
已弃用：0.1.16
移除：0.3.0

替代方案：`langchain_core.utils.function_calling.convert_to_openai_tool()`

### langchain

#### AgentType

模块：`agents.agent_types`
已弃用：0.1.0
移除：0.3.0

替代方案：使用 [LangGraph](/docs/how_to/migrate_agent/) 或新的 Agent 构造函数方法，例如 `create_react_agent`、`create_json_agent`、`create_structured_chat_agent` 等。

#### Chain.__call__

模块：`chains.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`invoke`

#### Chain.acall

模块：`chains.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`ainvoke`

#### Chain.run

模块：`chains.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`invoke`

#### Chain.arun

模块：`chains.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`ainvoke`

#### Chain.apply

模块：`chains.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`batch`

#### LLMChain

模块：`chains.llm`
已弃用：0.1.17
移除：0.3.0

替代方案：[RunnableSequence](/docs/how_to/sequence/)，例如 `prompt | llm`

此[迁移指南](/docs/versions/migrating_chains/llm_chain) 提供了并排比较。

#### LLMSingleActionAgent

模块：`agents.agent`
已弃用：0.1.0
移除：0.3.0

替代方案：使用 [LangGraph](/docs/how_to/migrate_agent/) 或新的 Agent 构造函数方法，例如 `create_react_agent`、`create_json_agent`、`create_structured_chat_agent` 等。

#### Agent

模块：`agents.agent`
已弃用：0.1.0
移除：0.3.0

替代方案：使用 [LangGraph](/docs/how_to/migrate_agent/) 或新的 Agent 构造函数方法，例如 `create_react_agent`、`create_json_agent`、`create_structured_chat_agent` 等。

#### OpenAIFunctionsAgent

模块：`agents.openai_functions_agent.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_openai_functions_agent`

#### ZeroShotAgent

模块：`agents.mrkl.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_react_agent`

#### MRKLChain

模块：`agents.mrkl.base`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### ConversationalAgent

模块：`agents.conversational.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_react_agent`

#### ConversationalChatAgent

模块：`agents.conversational_chat.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_json_chat_agent`

#### ChatAgent

模块：`agents.chat.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_react_agent`

#### OpenAIMultiFunctionsAgent

模块：`agents.openai_functions_multi_agent.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_openai_tools_agent`

#### ReActDocstoreAgent

模块：`agents.react.base`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### DocstoreExplorer

模块：`agents.react.base`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### ReActTextWorldAgent

模块：`agents.react.base`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### ReActChain

模块：`agents.react.base`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### SelfAskWithSearchAgent

模块：`agents.self_ask_with_search.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_self_ask_with_search`

#### SelfAskWithSearchChain

模块：`agents.self_ask_with_search.base`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### StructuredChatAgent

模块：`agents.structured_chat.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_structured_chat_agent`

#### RetrievalQA

模块：`chains.retrieval_qa.base`
已弃用：0.1.17
移除：0.3.0

替代方案：[create_retrieval_chain](https://python.langchain.com/api_reference/langchain/chains/langchain.chains.retrieval.create_retrieval_chain.html#langchain-chains-retrieval-create-retrieval-chain)
此[迁移指南](/docs/versions/migrating_chains/retrieval_qa) 提供了并排比较。

#### load_agent_from_config

模块：`agents.loading`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### load_agent

模块：`agents.loading`
已弃用：0.1.0
移除：0.3.0

替代方案：

#### initialize_agent

模块：`agents.initialize`
已弃用：0.1.0
移除：0.3.0

替代方案：使用 [LangGraph](/docs/how_to/migrate_agent/) 或新的 Agent 构造函数方法，例如 `create_react_agent`、`create_json_agent`、`create_structured_chat_agent` 等。

#### XMLAgent

模块：`agents.xml.base`
已弃用：0.1.0
移除：0.3.0

替代方案：`create_xml_agent`

#### CohereRerank

模块：`retrievers.document_compressors.cohere_rerank`
已弃用：0.0.30
移除：0.3.0

替代方案：`langchain_cohere.CohereRerank`

#### ConversationalRetrievalChain

模块：`chains.conversational_retrieval.base`
已弃用：0.1.17
移除：0.3.0

替代方案：[create_history_aware_retriever](https://python.langchain.com/api_reference/langchain/chains/langchain.chains.history_aware_retriever.create_history_aware_retriever.html) 和 [create_retrieval_chain](https://python.langchain.com/api_reference/langchain/chains/langchain.chains.retrieval.create_retrieval_chain.html#langchain-chains-retrieval-create-retrieval-chain)（请参阅文档字符串中的示例）
此[迁移指南](/docs/versions/migrating_chains/conversation_retrieval_chain) 提供了并排比较。

#### create_extraction_chain_pydantic

模块：`chains.openai_tools.extraction`
已弃用：0.1.14
移除：0.3.0

替代方案：支持工具调用的聊天模型的 [with_structured_output](/docs/how_to/structured_output/#the-with_structured_output-method) 方法。

#### create_openai_fn_runnable

模块：`chains.structured_output.base`
已弃用：0.1.14
移除：0.3.0

替代方案：支持工具调用的聊天模型的 [with_structured_output](/docs/how_to/structured_output/#the-with_structured_output-method) 方法。

#### create_structured_output_runnable

模块：`chains.structured_output.base`
已弃用：0.1.17
移除：0.3.0

替代方案：支持工具调用的聊天模型的 [with_structured_output](/docs/how_to/structured_output/#the-with_structured_output-method) 方法。

#### create_openai_fn_chain

模块：`chains.openai_functions.base`
已弃用：0.1.1
移除：0.3.0

替代方案：`create_openai_fn_runnable`

#### create_structured_output_chain

模块：`chains.openai_functions.base`
已弃用：0.1.1
移除：0.3.0

替代方案：`ChatOpenAI.with_structured_output`

#### create_extraction_chain

模块：`chains.openai_functions.extraction`
已弃用：0.1.14
移除去：0.3.0

替代方案：支持工具调用的聊天模型的 [with_structured_output](/docs/how_to/structured_output/#the-with_structured_output-method) 方法。

#### create_extraction_chain_pydantic

模块：`chains.openai_functions.extraction`
已弃用：0.1.14
移除：0.3.0

替代方案：支持工具调用的聊天模型的 [with_structured_output](/docs/how_to/structured_output/#the-with_structured_output-method) 方法。